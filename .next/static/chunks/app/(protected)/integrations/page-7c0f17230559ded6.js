(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{18306:function(e,s,a){Promise.resolve().then(a.bind(a,88021))},88021:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return I}});var t=a(57437),r=a(2265),i=a(79820),n=a(75060),l=a(40279),o=a(12381),c=a(69174),d=a(17168),u=a(33804),m=a(92934),x=a(99388),h=a(42488),g=a(82431),p=a(83578),f=a(29985),j=a(23628),v=a(78867),N=a(83229),b=a(14438),w=a(33341),y=a(91696),_=a(90535),A=a(93448);let S=(0,_.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),k=r.forwardRef((e,s)=>{let{className:a,variant:r,...i}=e;return(0,t.jsx)("div",{ref:s,role:"alert",className:(0,A.cn)(S({variant:r}),a),...i})});k.displayName="Alert";let E=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("h5",{ref:s,className:(0,A.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})});E.displayName="AlertTitle";let C=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,A.cn)("text-sm [&_p]:leading-relaxed",a),...r})});function I(){let{isAdmin:e,isLoading:s}=(0,y.j)(),[a,_]=(0,r.useState)(""),[A,S]=(0,r.useState)([]),[I,D]=(0,r.useState)(!1),[T,Z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{Z(!0)},[]),(0,r.useEffect)(()=>{if(!T)return;let e=localStorage.getItem("whatsapp_webhook_url");e&&_(e),O()},[T]);let O=async()=>{D(!0);try{let e=await (0,w.FA)(50);S(e)}catch(e){console.error("Erro ao carregar logs:",e)}finally{D(!1)}},P=e=>{let s={EXPORT_LEADS:{color:"bg-blue-500",icon:m.Z},WHATSAPP_DISPATCH:{color:"bg-green-500",icon:m.Z},START_PROSPECTION:{color:"bg-purple-500",icon:m.Z},BULK_DELETE_LEADS:{color:"bg-red-500",icon:x.Z}}[e]||{color:"bg-gray-500",icon:h.Z},a=s.icon;return(0,t.jsxs)(c.C,{className:"".concat(s.color," text-white gap-1"),children:[(0,t.jsx)(a,{className:"h-3 w-3"}),e.replace(/_/g," ")]})},R=e=>{let s=new Date(e);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)};return s?(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsx)(g.Z,{className:"h-8 w-8 animate-spin text-primary"})})}):e?(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[(0,t.jsxs)("div",{className:"animate-fade-in",children:[(0,t.jsxs)("h1",{className:"text-4xl font-bold mb-2 flex items-center gap-3",children:[(0,t.jsx)(f.Z,{className:"h-10 w-10 text-primary"}),"Integra\xe7\xf5es"]}),(0,t.jsx)("p",{className:"text-xl text-muted-foreground",children:"Configure webhooks e visualize logs de integra\xe7\xe3o"})]}),(0,t.jsxs)(d.mQ,{defaultValue:"webhooks",className:"animate-fade-in",children:[(0,t.jsxs)(d.dr,{className:"grid w-full grid-cols-2 max-w-md",children:[(0,t.jsxs)(d.SP,{value:"webhooks",className:"gap-2",children:[(0,t.jsx)(j.Z,{className:"h-4 w-4"}),"Webhooks"]}),(0,t.jsxs)(d.SP,{value:"logs",className:"gap-2",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),"Logs de Auditoria"]})]}),(0,t.jsxs)(d.nU,{value:"webhooks",className:"space-y-6",children:[(0,t.jsx)(i.Zb,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold",children:"Webhook WhatsApp (n8n)"}),(0,t.jsx)(c.C,{variant:"outline",children:"Evolution API"})]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Configure o endpoint do n8n que recebe os disparos de WhatsApp. Este webhook deve processar os leads e enviar as mensagens via Evolution API."}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n._,{htmlFor:"webhook-url",children:"URL do Webhook"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.I,{id:"webhook-url",placeholder:"https://n8n.seudominio.com/webhook/whatsapp",value:a,onChange:e=>_(e.target.value),className:"flex-1"}),(0,t.jsx)(o.z,{variant:"outline",size:"icon",onClick:()=>{navigator.clipboard.writeText(a),b.Am.success("URL copiada para \xe1rea de transfer\xeancia")},disabled:!a,children:(0,t.jsx)(v.Z,{className:"h-4 w-4"})})]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)(o.z,{onClick:()=>{try{localStorage.setItem("whatsapp_webhook_url",a),b.Am.success("Webhook salvo com sucesso!")}catch(e){b.Am.error("Erro ao salvar webhook")}},children:[(0,t.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"Salvar Configura\xe7\xe3o"]})}),(0,t.jsxs)("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"ℹ️ Informa\xe7\xf5es Importantes"}),(0,t.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[(0,t.jsx)("li",{children:"O webhook deve aceitar POST requests com JSON payload"}),(0,t.jsx)("li",{children:"Payload cont\xe9m: leadId, whatsapp, message, leadName, empresa"}),(0,t.jsxs)("li",{children:["Resposta esperada: ","{ success: true }"," ou ",'{ success: false, error: "..." }']}),(0,t.jsx)("li",{children:"Configura\xe7\xe3o armazenada localmente (localStorage)"})]})]})]})}),(0,t.jsx)(i.Zb,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold",children:"Supabase"}),(0,t.jsxs)(c.C,{className:"bg-green-500 text-white gap-1",children:[(0,t.jsx)(m.Z,{className:"h-3 w-3"}),"Conectado"]})]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Banco de dados e autentica\xe7\xe3o gerenciados pelo Supabase. Configura\xe7\xe3o via vari\xe1veis de ambiente (somente leitura)."}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n._,{children:"Project URL"}),(0,t.jsx)(l.I,{value:"https://kzvnwqlcrtxwagxkghxq.supabase.co",disabled:!0,className:"bg-muted"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n._,{children:"Status"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Z,{className:"h-5 w-5 text-green-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Conectado e operacional"})]})]})]})})]}),(0,t.jsx)(d.nU,{value:"logs",className:"space-y-4",children:(0,t.jsxs)(i.Zb,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold",children:"Logs de Auditoria"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Hist\xf3rico de todas as a\xe7\xf5es cr\xedticas realizadas"})]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:O,disabled:I,children:[(0,t.jsx)(g.Z,{className:"h-4 w-4 mr-2 ".concat(I?"animate-spin":"")}),"Atualizar"]})]}),I?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(g.Z,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),"Carregando logs..."]}):0===A.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(h.Z,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"Nenhum log de auditoria encontrado"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Os logs aparecer\xe3o aqui ap\xf3s a\xe7\xf5es no sistema"})]}):(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,t.jsxs)(u.iA,{children:[(0,t.jsx)(u.xD,{children:(0,t.jsxs)(u.SC,{children:[(0,t.jsx)(u.ss,{children:"Data/Hora"}),(0,t.jsx)(u.ss,{children:"A\xe7\xe3o"}),(0,t.jsx)(u.ss,{children:"Tipo"}),(0,t.jsx)(u.ss,{children:"Detalhes"})]})}),(0,t.jsx)(u.RM,{children:A.map(e=>(0,t.jsxs)(u.SC,{children:[(0,t.jsx)(u.pj,{className:"text-sm whitespace-nowrap",children:R(e.created_at)}),(0,t.jsx)(u.pj,{children:P(e.action)}),(0,t.jsx)(u.pj,{children:(0,t.jsx)(c.C,{variant:"outline",children:e.entity_type})}),(0,t.jsx)(u.pj,{className:"text-sm text-muted-foreground max-w-md truncate",children:e.details&&Object.keys(e.details).length>0?JSON.stringify(e.details).substring(0,100)+"...":"—"})]},e.id))})]})})]})})]})]}):(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)(k,{variant:"destructive",children:[(0,t.jsx)(p.Z,{className:"h-5 w-5"}),(0,t.jsx)(E,{children:"Acesso Negado"}),(0,t.jsx)(C,{children:"Apenas administradores podem acessar a p\xe1gina de Integra\xe7\xf5es. Entre em contato com um administrador se precisar configurar webhooks ou visualizar logs de auditoria."})]})})}C.displayName="AlertDescription"},17168:function(e,s,a){"use strict";a.d(s,{SP:function(){return c},dr:function(){return o},mQ:function(){return l},nU:function(){return d}});var t=a(57437),r=a(2265),i=a(20271),n=a(93448);let l=i.fC,o=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(i.aV,{ref:s,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});o.displayName=i.aV.displayName;let c=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(i.xz,{ref:s,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",a),...r})});c.displayName=i.xz.displayName;let d=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(i.VY,{ref:s,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});d.displayName=i.VY.displayName},33341:function(e,s,a){"use strict";a.d(s,{FA:function(){return i},hn:function(){return n},pA:function(){return l},v5:function(){return o}});var t=a(1072);let r=async e=>{try{console.log("[AUDIT]",{timestamp:new Date().toISOString(),...e});let{data:{user:s}}=await t.O.auth.getUser();if(!s){console.warn("[AUDIT] Usu\xe1rio n\xe3o autenticado, log n\xe3o salvo");return}let{error:a}=await t.O.from("audit_logs").insert({user_id:s.id,action:e.action,entity_type:e.entity_type,entity_id:e.entity_id,details:e.details,ip_address:null,user_agent:navigator.userAgent});if(a){console.error("[AUDIT] Erro ao salvar log:",a);let t=JSON.parse(localStorage.getItem("audit_logs_fallback")||"[]");t.push({timestamp:new Date().toISOString(),user_id:s.id,...e}),t.length>100&&t.shift(),localStorage.setItem("audit_logs_fallback",JSON.stringify(t))}}catch(e){console.error("[AUDIT] Erro ao registrar log de auditoria:",e)}},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let{data:s,error:a}=await t.O.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(e);if(a)throw a;return s||[]}catch(e){return console.error("[AUDIT] Erro ao buscar logs:",e),[]}},n=(e,s)=>{r({action:"EXPORT_LEADS",entity_type:"lead",details:{leadCount:e,format:s}})},l=(e,s,a)=>{r({action:"WHATSAPP_DISPATCH",entity_type:"lead",details:{leadIds:e,successCount:s,failedCount:a,total:e.length}})},o=e=>{r({action:"BULK_DELETE_LEADS",entity_type:"lead",details:{leadIds:e,count:e.length}})}}},function(e){e.O(0,[457,918,318,923,763,713,706,50,177,971,117,744],function(){return e(e.s=18306)}),_N_E=e.O()}]);