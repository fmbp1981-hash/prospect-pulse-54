(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[526],{20067:function(){},72061:function(){},19602:function(e,a,s){Promise.resolve().then(s.bind(s,59058))},59058:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return eN}});var t=s(57437),r=s(2265),l=s(55112),n=s(12381),i=s(68245),o=s(33804),d=s(69174),c=s(51817),m=s(82029),u=s(7586),p=s(55736),h=s(82431),x=s(28842),g=s(82718),f=s(15868),j=s(96362),v=s(14438),N=s(15291),b=s(75060),y=s(40279),w=s(32489);let C=e=>{let{statusFilter:a,setStatusFilter:s,hasWhatsAppFilter:l,setHasWhatsAppFilter:o,whatsappStatusFilter:d,setWhatsappStatusFilter:c,cidadeFilter:m,setCidadeFilter:u,bairroFilter:p,setBairroFilter:h,dateRangeFilter:x,setDateRangeFilter:g}=e,[f,j]=(0,r.useState)(!1),v={all:"Todos",not_sent:"N\xe3o Enviado",sent:"Enviado",failed:"Falhou"};return(0,t.jsxs)("div",{className:"rounded-lg border bg-card shadow-card p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 items-end",children:[(0,t.jsxs)("div",{className:"space-y-2 flex-1 min-w-[200px]",children:[(0,t.jsx)(b._,{htmlFor:"status-filter",children:"Status do Lead"}),(0,t.jsxs)(N.Ph,{value:a,onValueChange:e=>s(e),children:[(0,t.jsx)(N.i4,{id:"status-filter",children:(0,t.jsx)(N.ki,{placeholder:"Todos os status"})}),(0,t.jsx)(N.Bw,{children:["all","Novo Lead","Contato Inicial","Qualifica\xe7\xe3o","Proposta Enviada","Negocia\xe7\xe3o","Fechado Ganho","Fechado Perdido","Em Follow-up","Fechado","Follow-up"].map(e=>(0,t.jsx)(N.Ql,{value:e,children:"all"===e?"Todos os status":e},e))})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 pb-1",children:[(0,t.jsx)(i.X,{id:"whatsapp-filter",checked:l,onCheckedChange:o}),(0,t.jsx)("label",{htmlFor:"whatsapp-filter",className:"text-sm font-medium cursor-pointer",children:"Apenas com WhatsApp"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>j(!f),children:f?"Ocultar":"Filtros Avan\xe7ados"}),(0,t.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:()=>{s("all"),o(!1),c&&c("all"),u&&u(""),h&&h(""),g&&g(void 0)},children:[(0,t.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),"Limpar"]})]})]}),f&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t",children:[c&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(b._,{htmlFor:"wa-status-filter",children:"Status WhatsApp"}),(0,t.jsxs)(N.Ph,{value:d||"all",onValueChange:e=>c(e),children:[(0,t.jsx)(N.i4,{id:"wa-status-filter",children:(0,t.jsx)(N.ki,{placeholder:"Todos"})}),(0,t.jsx)(N.Bw,{children:["all","not_sent","sent","failed"].map(e=>(0,t.jsx)(N.Ql,{value:e,children:v[e]},e))})]})]}),u&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(b._,{htmlFor:"cidade-filter",children:"Cidade"}),(0,t.jsx)(y.I,{id:"cidade-filter",placeholder:"Ex: S\xe3o Paulo",value:m||"",onChange:e=>u(e.target.value)})]}),h&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(b._,{htmlFor:"bairro-filter",children:"Bairro"}),(0,t.jsx)(y.I,{id:"bairro-filter",placeholder:"Ex: Centro",value:p||"",onChange:e=>h(e.target.value)})]}),g&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(b._,{children:"Per\xedodo de Cria\xe7\xe3o"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(y.I,{type:"date",value:(null==x?void 0:x.start)||"",onChange:e=>g({start:e.target.value,end:(null==x?void 0:x.end)||""}),placeholder:"Data inicial"}),(0,t.jsx)(y.I,{type:"date",value:(null==x?void 0:x.end)||"",onChange:e=>g({start:(null==x?void 0:x.start)||"",end:e.target.value}),placeholder:"Data final"})]})]})]})]})};var A=s(93448),_=s(57586),k=s(98239),S=s(92735),E=s(48736),D=s(18930);let z=e=>{let{selectedCount:a,onClearSelection:s,onExport:r,onWhatsApp:l,onApplyTemplate:i,onDelete:o,canExport:d=!0,canSendWhatsApp:c=!0,canUpdate:m=!0,canDelete:u=!0}=e;return(0,t.jsx)(_.M,{children:a>0&&(0,t.jsx)(k.E.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50",children:(0,t.jsxs)("div",{className:"bg-primary text-primary-foreground rounded-full shadow-2xl px-6 py-4 flex items-center gap-4",children:[(0,t.jsxs)("span",{className:"font-semibold",children:[a," lead(s) selecionado(s)"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[d&&(0,t.jsxs)(n.z,{variant:"ghost",size:"sm",className:"text-primary-foreground hover:bg-primary-foreground/20",onClick:r,children:[(0,t.jsx)(S.Z,{className:"h-4 w-4 mr-2"}),"Exportar"]}),m&&i&&(0,t.jsxs)(n.z,{variant:"ghost",size:"sm",className:"text-primary-foreground hover:bg-primary-foreground/20",onClick:i,children:[(0,t.jsx)(E.Z,{className:"h-4 w-4 mr-2"}),"Aplicar Template"]}),c&&(0,t.jsxs)(n.z,{variant:"ghost",size:"sm",className:"text-primary-foreground hover:bg-primary-foreground/20",onClick:l,children:[(0,t.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"WhatsApp"]}),u&&(0,t.jsx)(n.z,{variant:"ghost",size:"sm",className:"text-primary-foreground hover:bg-destructive/20",onClick:o,children:(0,t.jsx)(D.Z,{className:"h-4 w-4"})})]}),(0,t.jsx)(n.z,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-primary-foreground/20 ml-2",onClick:s,children:(0,t.jsx)(w.Z,{className:"h-4 w-4"})})]})})})};var T=s(74291),W=s(1505);let F=r.forwardRef((e,a)=>{let{className:s,value:r,...l}=e;return(0,t.jsx)(W.fC,{ref:a,className:(0,A.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...l,children:(0,t.jsx)(W.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});F.displayName=W.fC.displayName;var O=s(99388),M=s(92934),R=s(33341);let Z=e=>{let{isOpen:a,onClose:s,selectedLeads:i}=e,[o,m]=(0,r.useState)([]),[u,p]=(0,r.useState)(!1),[h,x]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1),[j,N]=(0,r.useState)(""),[b,y]=(0,r.useState)(""),[w,C]=(0,r.useState)(!1),A=i.filter(e=>e.whatsapp&&""!==e.whatsapp.trim()&&e.mensagemWhatsApp&&""!==e.mensagemWhatsApp.trim()&&"sent"!==e.statusMsgWA),_=i.filter(e=>!e.whatsapp||""===e.whatsapp.trim()),k=i.filter(e=>e.whatsapp&&""!==e.whatsapp.trim()&&!e.mensagemWhatsApp),S=i.filter(e=>"sent"===e.statusMsgWA);(0,r.useEffect)(()=>{a&&1===A.length?(y(A[0].mensagemWhatsApp||""),C(!0)):C(!1)},[a,A.length]),(0,r.useEffect)(()=>{a&&A.length>0&&m(A.map(e=>({leadId:e.id,leadName:e.lead,message:e.mensagemWhatsApp,status:"pending"})))},[a,A]);let E=async()=>{if(0===A.length){v.Am.error("Nenhum lead v\xe1lido para teste");return}if(!j.trim()){v.Am.error("Digite um n\xfamero de WhatsApp para teste");return}let e=localStorage.getItem("whatsapp_webhook_url");if(!e){v.Am.error("Configure o webhook WhatsApp nas Configura\xe7\xf5es da sidebar");return}x(!0),p(!0),f(!1);let a=A[0],s=w&&b?b:a.mensagemWhatsApp;m([{leadId:a.id,leadName:a.lead,message:s,status:"sending"}]);try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leadId:a.id,whatsapp:j,message:s,leadName:a.lead,empresa:a.empresa})});if(!t.ok)throw Error("Webhook retornou ".concat(t.status));let r=await t.json();if(!0===r.success)m([{leadId:a.id,leadName:a.lead,message:s,status:"sent"}]),v.Am.success("Mensagem de teste enviada com sucesso!",{description:"Enviado para ".concat(j)});else throw Error(r.error||r.message||"Falha no envio")}catch(e){m([{leadId:a.id,leadName:a.lead,message:s,status:"failed",error:String(e)}]),v.Am.error("Falha no envio de teste",{description:String(e)})}p(!1)},D=async()=>{if(u||0===A.length){v.Am.error("Nenhum lead v\xe1lido para enviar",{description:"Verifique se os leads possuem WhatsApp e mensagem configurados"});return}let e=localStorage.getItem("whatsapp_webhook_url");if(!e){v.Am.error("Configure o webhook WhatsApp nas Configura\xe7\xf5es da sidebar");return}x(!1),p(!0);for(let a=0;a<A.length;a++){let s=A[a];if(!s.whatsapp||""===s.whatsapp.trim()){m(e=>e.map(e=>e.leadId===s.id?{...e,status:"failed",error:"WhatsApp n\xe3o coletado"}:e));continue}m(e=>e.map(e=>e.leadId===s.id?{...e,status:"sending"}:e));let t=w&&b&&1===A.length?b:s.mensagemWhatsApp;try{let a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leadId:s.id,whatsapp:s.whatsapp,message:t,leadName:s.lead,empresa:s.empresa})});if(!a.ok)throw Error("Webhook retornou ".concat(a.status));let r=await a.json(),n=!0===r.success;n&&(await l.gZ.updateLead(s.id,{statusMsgWA:"sent",dataEnvioWA:new Date().toISOString(),...w&&1===A.length?{mensagemWhatsApp:t}:{}}),("Novo Lead"===s.status||"Novo"===s.status)&&await l.gZ.updateLeadStatus(s.id,"Contato Inicial")),m(e=>e.map(e=>e.leadId===s.id?{...e,status:n?"sent":"failed",error:n?void 0:r.error||r.message,message:t}:e)),await new Promise(e=>setTimeout(e,500))}catch(e){m(a=>a.map(a=>a.leadId===s.id?{...a,status:"failed",error:String(e)}:a))}}let a=o.filter(e=>"sent"===e.status).length,s=o.filter(e=>"failed"===e.status).length;await (0,R.pA)(A.map(e=>e.id),a,s),p(!1)},z=o.length>0?o.filter(e=>"sent"===e.status||"failed"===e.status).length/o.length*100:0,W=o.filter(e=>"sent"===e.status).length,Z=o.filter(e=>"failed"===e.status).length,P=100===z;return(0,t.jsx)(T.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(T.cZ,{className:"max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,t.jsx)(T.fK,{children:(0,t.jsx)(T.$N,{children:"Envio de Mensagens WhatsApp"})}),(_.length>0||k.length>0||S.length>0)&&(0,t.jsxs)("div",{className:"space-y-2",children:[_.length>0&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(O.Z,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-red-900",children:[_.length," lead(s) sem n\xfamero de WhatsApp coletado"]}),(0,t.jsx)("p",{className:"text-xs text-red-700 mt-1",children:"Estes leads n\xe3o receber\xe3o mensagens:"}),(0,t.jsx)("ul",{className:"text-xs text-red-600 mt-2 space-y-1 max-h-24 overflow-y-auto",children:_.map(e=>(0,t.jsxs)("li",{children:["• ",e.lead," (",e.empresa,")"]},e.id))})]})]})}),k.length>0&&(0,t.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(O.Z,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-yellow-900",children:[k.length," lead(s) sem mensagem configurada"]}),(0,t.jsx)("p",{className:"text-xs text-yellow-700 mt-1",children:"Configure a mensagem no CRM antes de enviar:"}),(0,t.jsx)("ul",{className:"text-xs text-yellow-600 mt-2 space-y-1 max-h-24 overflow-y-auto",children:k.map(e=>(0,t.jsxs)("li",{children:["• ",e.lead]},e.id))})]})]})}),S.length>0&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(M.Z,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:[S.length," lead(s) j\xe1 receberam mensagem anteriormente"]}),(0,t.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"Estes leads ser\xe3o ignorados para evitar envio duplicado"})]})]})})]}),0===A.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum lead v\xe1lido para envio de mensagens."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F,{value:z,className:"h-2"}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{className:"text-success font-medium",children:[W," enviados"]}),(0,t.jsxs)("span",{className:"text-destructive font-medium",children:[Z," falhas"]}),(0,t.jsxs)("span",{children:[A.length," total"]})]})]}),(0,t.jsx)("div",{className:"space-y-2 overflow-y-auto flex-1 pr-2",children:!w||1!==A.length||u||P?o.map(e=>(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-3 bg-muted rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-medium truncate flex-1",children:e.leadName}),"pending"===e.status&&(0,t.jsx)(d.C,{variant:"outline",children:"Aguardando"}),"sending"===e.status&&(0,t.jsxs)(d.C,{variant:"secondary",className:"gap-2",children:[(0,t.jsx)(c.Z,{className:"h-3 w-3 animate-spin"}),"Enviando..."]}),"sent"===e.status&&(0,t.jsxs)(d.C,{className:"gap-2 bg-success hover:bg-success/90",children:[(0,t.jsx)(M.Z,{className:"h-3 w-3"}),"Enviado"]}),"failed"===e.status&&(0,t.jsxs)(d.C,{variant:"destructive",className:"gap-2",children:[(0,t.jsx)(O.Z,{className:"h-3 w-3"}),"Falha"]})]}),e.message&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:["\uD83D\uDCF1 ",e.message.substring(0,60),"..."]}),e.error&&"failed"===e.status&&(0,t.jsxs)("p",{className:"text-xs text-destructive",children:["⚠️ ",e.error]})]},e.leadId)):(0,t.jsxs)("div",{className:"space-y-2 p-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["Editar Mensagem para ",A[0].lead,":"]}),(0,t.jsx)("textarea",{className:"flex min-h-[150px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:b,onChange:e=>y(e.target.value)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Voc\xea pode personalizar a mensagem final antes de enviar."})]})})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2 pt-4 border-t",children:P?(0,t.jsx)(n.z,{onClick:s,className:"w-full",children:"Fechar"}):(0,t.jsxs)(t.Fragment,{children:[!u&&A.length>0&&!h&&(0,t.jsx)(n.z,{variant:"secondary",onClick:()=>f(!0),className:"w-full",children:"\uD83D\uDCE4 Enviar Teste (1 mensagem)"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.z,{variant:"outline",onClick:s,disabled:u,className:"flex-1",children:"Cancelar"}),(0,t.jsx)(n.z,{onClick:D,disabled:u||0===A.length,className:"flex-1",children:u&&!h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Enviando..."]}):"Enviar para ".concat(A.length," lead(s)")})]})]})}),g&&A.length>0&&(0,t.jsx)("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-sm flex items-center justify-center p-6 rounded-lg z-50",children:(0,t.jsxs)("div",{className:"bg-card border rounded-lg p-6 max-w-md w-full space-y-4 shadow-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Confirmar Envio de Teste"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Configure o n\xfamero de destino para o teste."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"N\xfamero de WhatsApp para Teste"}),(0,t.jsx)("input",{type:"text",placeholder:"Ex: 5511999999999",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:j,onChange:e=>N(e.target.value)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Digite o n\xfamero completo com DDI e DDD (apenas n\xfameros)."})]}),(0,t.jsxs)("div",{className:"bg-muted p-4 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Lead Simulado:"}),(0,t.jsx)("span",{className:"text-sm text-right",children:A[0].lead})]}),(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Empresa:"}),(0,t.jsx)("span",{className:"text-sm text-right",children:A[0].empresa})]})]}),(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-blue-900 mb-2",children:"Preview da Mensagem:"}),(0,t.jsx)("p",{className:"text-xs text-blue-800 whitespace-pre-wrap max-h-32 overflow-y-auto",children:w&&b?b:A[0].mensagemWhatsApp})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsx)(n.z,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Cancelar"}),(0,t.jsx)(n.z,{onClick:E,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"Enviar Teste"})]})]})})]})})};var P=s(42325),L=s(40519);let I=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(P.fC,{className:(0,A.cn)("grid gap-2",s),...r,ref:a})});I.displayName=P.fC.displayName;let U=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(P.ck,{ref:a,className:(0,A.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...r,children:(0,t.jsx)(P.z$,{className:"flex items-center justify-center",children:(0,t.jsx)(L.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});U.displayName=P.ck.displayName;var B=s(61649);let q=e=>{let{isOpen:a,onClose:s,onExport:l,availableColumns:o}=e,[d,c]=(0,r.useState)("excel"),[m,u]=(0,r.useState)(new Set(o)),p=e=>{let a=new Set(m);a.has(e)?a.delete(e):a.add(e),u(a)};return(0,t.jsx)(T.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(T.cZ,{className:"max-w-md",children:[(0,t.jsx)(T.fK,{children:(0,t.jsx)(T.$N,{children:"Exportar Leads"})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(b._,{children:"Formato de Exporta\xe7\xe3o"}),(0,t.jsxs)(I,{value:d,onValueChange:e=>c(e),children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-muted cursor-pointer transition-colors",children:[(0,t.jsx)(U,{value:"excel",id:"excel"}),(0,t.jsxs)(b._,{htmlFor:"excel",className:"flex items-center gap-2 cursor-pointer flex-1",children:[(0,t.jsx)(B.Z,{className:"h-4 w-4 text-success"}),"Excel (.xlsx)"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-muted cursor-pointer transition-colors",children:[(0,t.jsx)(U,{value:"csv",id:"csv"}),(0,t.jsxs)(b._,{htmlFor:"csv",className:"flex items-center gap-2 cursor-pointer flex-1",children:[(0,t.jsx)(E.Z,{className:"h-4 w-4 text-primary"}),"CSV (.csv)"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(b._,{children:"Colunas a Exportar"}),(0,t.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>{m.size===o.length?u(new Set):u(new Set(o))},children:m.size===o.length?"Desmarcar todas":"Marcar todas"})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto p-2 border rounded-lg",children:o.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(i.X,{id:e,checked:m.has(e),onCheckedChange:()=>p(e)}),(0,t.jsx)(b._,{htmlFor:e,className:"text-sm cursor-pointer",children:e})]},e))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.z,{variant:"outline",onClick:s,className:"flex-1",children:"Cancelar"}),(0,t.jsxs)(n.z,{onClick:()=>{l(d,Array.from(m)),s()},className:"flex-1",disabled:0===m.size,children:["Exportar ",m.size," colunas"]})]})]})]})})};var V=s(21191),G=s(79820),$=s(43643);let J=r.forwardRef((e,a)=>{let{className:s,children:r,...l}=e;return(0,t.jsxs)($.fC,{ref:a,className:(0,A.cn)("relative overflow-hidden",s),...l,children:[(0,t.jsx)($.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,t.jsx)(X,{}),(0,t.jsx)($.Ns,{})]})});J.displayName=$.fC.displayName;let X=r.forwardRef((e,a)=>{let{className:s,orientation:r="vertical",...l}=e;return(0,t.jsx)($.gb,{ref:a,orientation:r,className:(0,A.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,t.jsx)($.q4,{className:"relative flex-1 rounded-full bg-border"})})});X.displayName=$.gb.displayName;var H=s(53417),K=s(41671),Y=s(8522),Q=s(40359),ee=s(76284);function ea(e){let{isOpen:a,onClose:s,selectedLeads:i,onTemplateApplied:o}=e,[c,m]=(0,r.useState)([]),[u,p]=(0,r.useState)(null),[h,x]=(0,r.useState)(!1),[g,f]=(0,r.useState)("");(0,r.useEffect)(()=>{a&&(j(),N())},[a]);let j=()=>{let e=localStorage.getItem("whatsapp_templates");e&&m(JSON.parse(e))},N=async()=>{try{console.log("\uD83D\uDD0D ApplyTemplateModal: Carregando configura\xe7\xf5es do usu\xe1rio...");let e=await ee.T.getUserSettings();console.log("\uD83D\uDD0D ApplyTemplateModal: Configura\xe7\xf5es carregadas:",e),e?(f(e.company_name||""),console.log("✅ ApplyTemplateModal: Nome da empresa definido:",e.company_name)):console.log("⚠️ ApplyTemplateModal: Nenhuma configura\xe7\xe3o encontrada")}catch(e){console.error("❌ ApplyTemplateModal: Erro ao carregar configura\xe7\xf5es:",e)}},b=e=>{if(e.variations&&e.variations.length>0){let a=e.variations.filter(e=>e.message&&""!==e.message.trim());if(a.length>0){let e=Math.floor(Math.random()*a.length);return a[e]}}return e.message||""},y=(e,a)=>{console.log("\uD83D\uDD04 ApplyTemplateModal: Substituindo vari\xe1veis..."),console.log("  - companyName atual:",g),console.log("  - Mensagem original:",e),console.log("  - Cont\xe9m {{minha_empresa}}?",e.includes("{{minha_empresa}}"));let s=e.replace(/\{\{minha_empresa\}\}/g,g||"Sua Empresa").replace(/\{\{empresa\}\}/g,a.empresa||"Empresa").replace(/\{\{categoria\}\}/g,a.categoria||"").replace(/\{\{cidade\}\}/g,a.cidade||"").replace(/\{\{contato\}\}/g,a.contato||a.empresa||"").replace(/\{\{lead\}\}/g,a.lead||"");return console.log("  - Mensagem ap\xf3s substitui\xe7\xe3o:",s),s},w=async()=>{if(!u){v.Am.error("Selecione um template");return}if(0===i.length){v.Am.error("Nenhum lead selecionado");return}x(!0);try{let e=i.map(e=>{let a=b(u),s="string"==typeof a?a:a.message,t=y(s,e);return l.gZ.updateLead(e.id,{mensagemWhatsApp:t})});await Promise.all(e),v.Am.success("Template aplicado a ".concat(i.length," lead(s)"),{description:"Mensagens personalizadas e prontas para envio!"}),o(),s()}catch(e){console.error("Erro ao aplicar template:",e),v.Am.error("Erro ao aplicar template aos leads")}finally{x(!1)}},C=(e,a)=>y(a,e);return(0,t.jsx)(T.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(T.cZ,{className:"max-w-3xl max-h-[85vh] overflow-hidden flex flex-col",children:[(0,t.jsx)(T.fK,{children:(0,t.jsxs)(T.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(H.Z,{className:"h-5 w-5"}),"Aplicar Template aos Leads Selecionados"]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4",children:[(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(K.Z,{className:"h-4 w-4 text-blue-600"}),(0,t.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:[i.length," lead(s) selecionado(s)"]})]}),(0,t.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"O template ser\xe1 aplicado com varia\xe7\xf5es aleat\xf3rias para evitar mensagens id\xeanticas"})]}),0===c.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(H.Z,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,t.jsx)("p",{children:"Nenhum template dispon\xedvel"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Crie templates no Gerenciador de Templates"})]}):(0,t.jsx)(J,{className:"h-[400px] pr-4",children:(0,t.jsx)("div",{className:"space-y-3",children:c.map(e=>{let a=(e.variations||(e.message?[{style:"formal",message:e.message}]:[])).filter(e=>e.message&&""!==e.message.trim()),s=(null==u?void 0:u.id)===e.id;return(0,t.jsx)(G.Zb,{className:"p-4 cursor-pointer transition-all ".concat(s?"border-primary border-2 bg-primary/5":"hover:border-primary/50"),onClick:()=>p(e),children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(d.C,{variant:"outline",className:"text-xs",children:e.category}),a.length>1&&(0,t.jsxs)(d.C,{variant:"default",className:"text-xs gap-1",children:[(0,t.jsx)(Y.Z,{className:"h-3 w-3"}),a.length," varia\xe7\xf5es"]})]})]}),s&&(0,t.jsx)(K.Z,{className:"h-5 w-5 text-primary"})]}),i.length>0&&a.length>0&&(0,t.jsxs)("div",{className:"bg-muted p-3 rounded-lg",children:[(0,t.jsxs)("p",{className:"text-xs font-medium mb-1",children:["Preview para ",i[0].lead,":"]}),(0,t.jsx)("p",{className:"text-xs whitespace-pre-wrap",children:C(i[0],a[0].message)})]}),a.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:a.map((e,a)=>(0,t.jsxs)(d.C,{variant:"secondary",className:"text-xs",children:[Q.g[e.style].emoji," ",Q.g[e.style].label]},a))})]})},e.id)})})})]}),(0,t.jsxs)(T.cN,{className:"flex-shrink-0",children:[(0,t.jsx)(n.z,{variant:"outline",onClick:s,disabled:h,children:"Cancelar"}),(0,t.jsx)(n.z,{onClick:w,disabled:!u||h||0===i.length,children:h?"Aplicando...":"Aplicar aos ".concat(i.length," Lead(s)")})]})]})})}var es=s(2093),et=s(15452),er=s.n(et);let el=e=>{if(null==e)return"";let a=String(e);return["=","+","-","@","	","\r"].some(e=>a.startsWith(e))?"'".concat(a):a},en=(e,a,s)=>{let t={Lead:"lead",Status:"status",Data:"data",Empresa:"empresa",Categoria:"categoria",Contato:"contato",WhatsApp:"whatsapp",Telefone:"telefone",Email:"email",Website:"website",Instagram:"instagram",Cidade:"cidade",Endereço:"endereco","Bairro/Regi\xe3o":"bairroRegiao","Link Google Maps":"linkGMN","Aceita Cart\xe3o":"aceitaCartao",CNPJ:"cnpj","Mensagem WhatsApp":"mensagemWhatsApp","Status WhatsApp":"statusMsgWA","Data Envio WA":"dataEnvioWA","Resumo Anal\xedtico":"resumoAnalitico",Origem:"origem",Prioridade:"prioridade",Região:"regiao",Segmento:"segmento","Ticket M\xe9dio Estimado":"ticketMedioEstimado","Contato Principal":"contatoPrincipal","Data Contato":"dataContato",Observações:"observacoes","Data Cria\xe7\xe3o":"createdAt","Data Atualiza\xe7\xe3o":"updatedAt"},r=e.map(e=>{let a={};return Object.entries(t).forEach(t=>{let[r,l]=t;(!s||s.includes(r))&&(a[r]=el(e[l]))}),a}),l=new Blob(["\uFEFF"+er().unparse(r,{delimiter:",",header:!0,newline:"\n"})],{type:"text/csv;charset=utf-8;"}),n=window.URL.createObjectURL(l),i=document.createElement("a");i.href=n,i.download="".concat(a,".csv"),i.click(),window.URL.revokeObjectURL(n)},ei=(e,a,s)=>{let t={Lead:"lead",Status:"status",Data:"data",Empresa:"empresa",Categoria:"categoria",Contato:"contato",WhatsApp:"whatsapp",Telefone:"telefone",Email:"email",Website:"website",Instagram:"instagram",Cidade:"cidade",Endereço:"endereco","Bairro/Regi\xe3o":"bairroRegiao","Link Google Maps":"linkGMN","Aceita Cart\xe3o":"aceitaCartao",CNPJ:"cnpj","Mensagem WhatsApp":"mensagemWhatsApp","Status WhatsApp":"statusMsgWA","Data Envio WA":"dataEnvioWA","Resumo Anal\xedtico":"resumoAnalitico",Origem:"origem",Prioridade:"prioridade",Região:"regiao",Segmento:"segmento","Ticket M\xe9dio Estimado":"ticketMedioEstimado","Contato Principal":"contatoPrincipal","Data de Contato":"dataContato",Observações:"observacoes","Data Cria\xe7\xe3o":"createdAt","Data Atualiza\xe7\xe3o":"updatedAt"},r=e.map(e=>{let a={};return Object.entries(t).forEach(t=>{let[r,l]=t;(!s||s.includes(r))&&(a[r]=e[l]||"")}),a}),l=es.P6.json_to_sheet(r),n=Object.keys(r[0]||{}).map(e=>({wch:Math.min(Math.max(e.length,...r.map(a=>String(a[e]||"").length))+2,50)}));l["!cols"]=n;let i=es.P6.book_new();es.P6.book_append_sheet(i,l,"Leads"),es.NC(i,"".concat(a,".xlsx"))};var eo=s(91696),ed=s(9674),ec=s(62741),em=s(30767),eu=s(92451),ep=s(10407);s(67782);let eh=e=>{let{className:a,...s}=e;return(0,t.jsx)("nav",{role:"navigation","aria-label":"pagination",className:(0,A.cn)("mx-auto flex w-full justify-center",a),...s})};eh.displayName="Pagination";let ex=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("ul",{ref:a,className:(0,A.cn)("flex flex-row items-center gap-1",s),...r})});ex.displayName="PaginationContent";let eg=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("li",{ref:a,className:(0,A.cn)("",s),...r})});eg.displayName="PaginationItem";let ef=e=>{let{className:a,isActive:s,size:r="icon",...l}=e;return(0,t.jsx)("a",{"aria-current":s?"page":void 0,className:(0,A.cn)((0,n.d)({variant:s?"outline":"ghost",size:r}),a),...l})};ef.displayName="PaginationLink";let ej=e=>{let{className:a,...s}=e;return(0,t.jsxs)(ef,{"aria-label":"Go to previous page",size:"default",className:(0,A.cn)("gap-1 pl-2.5",a),...s,children:[(0,t.jsx)(eu.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Previous"})]})};ej.displayName="PaginationPrevious";let ev=e=>{let{className:a,...s}=e;return(0,t.jsxs)(ef,{"aria-label":"Go to next page",size:"default",className:(0,A.cn)("gap-1 pr-2.5",a),...s,children:[(0,t.jsx)("span",{children:"Next"}),(0,t.jsx)(ep.Z,{className:"h-4 w-4"})]})};function eN(){let[e,a]=(0,r.useState)([]),[s,N]=(0,r.useState)(!0),[b,y]=(0,r.useState)(!1),[w,_]=(0,r.useState)("list"),{permissions:k,hasPermission:S}=(0,eo.j)(),[E,D]=(0,r.useState)(new Set),[T,W]=(0,r.useState)(!1),[F,O]=(0,r.useState)(!1),[M,P]=(0,r.useState)(!1),[L,I]=(0,r.useState)(!1),[U,B]=(0,r.useState)(!1),[G,$]=(0,r.useState)(null),[J,X]=(0,r.useState)(""),[H,K]=(0,r.useState)("all"),[Y,Q]=(0,r.useState)(!1),[ee,es]=(0,r.useState)("all"),[et,er]=(0,r.useState)(""),[el,eu]=(0,r.useState)(""),[ep,eN]=(0,r.useState)(void 0),[eb,ey]=(0,r.useState)("dataContato"),[ew,eC]=(0,r.useState)("desc"),[eA,e_]=(0,r.useState)(1),ek=async()=>{N(!0);try{let e=await l.gZ.syncAllLeads();e.success?a(Array.isArray(e.leads)?e.leads:[]):v.Am.error("Erro ao carregar leads",{description:e.message||"Erro ao acessar banco de dados"})}catch(e){console.error("Erro ao carregar leads:",e),v.Am.error("Erro ao carregar leads",{description:e instanceof Error?e.message:"Erro desconhecido"})}finally{N(!1)}},eS=async()=>{y(!0),await ek(),y(!1),v.Am.success("Leads atualizados!")};(0,r.useEffect)(()=>{ek()},[]);let eE=(0,r.useMemo)(()=>{let a=[...e];return J&&(a=a.filter(e=>{var a,s;return(0,A.zB)(e.lead||"",J)||(0,A.zB)(e.empresa||"",J)||(0,A.zB)(e.categoria||"",J)||(0,A.zB)(e.cidade||"",J)||(0,A.zB)(e.bairro||"",J)||(null===(a=e.whatsapp)||void 0===a?void 0:a.includes(J))||(null===(s=e.telefone)||void 0===s?void 0:s.includes(J))||(0,A.zB)(e.email||"",J)})),"all"!==H&&(a=a.filter(e=>e.status===H)),Y&&(a=a.filter(e=>e.whatsapp&&""!==e.whatsapp.trim())),"all"!==ee&&(a=a.filter(e=>e.statusMsgWA===ee)),et&&(a=a.filter(e=>(0,A.zB)(e.cidade||"",et))),el&&(a=a.filter(e=>(0,A.zB)(e.bairro||"",el))),a.sort((e,a)=>{var s,t;let r=null!==(s=e[eb])&&void 0!==s?s:"",l=null!==(t=a[eb])&&void 0!==t?t:"";return"asc"===ew?r<l?-1:r>l?1:0:r>l?-1:r<l?1:0}),a},[e,J,H,Y,ee,et,el,eb,ew]),eD=Math.ceil(eE.length/20),ez=eE.slice((eA-1)*20,20*eA),eT=e=>{let a=new Set(E);a.has(e)?a.delete(e):a.add(e),D(a)},eW=e=>{eb===e?eC("asc"===ew?"desc":"asc"):(ey(e),eC("desc"))},eF=e=>{$(e),B(!0)},eO=async()=>{if(0!==E.size){try{let e=Array.from(E);(await l.gZ.deleteLeads(e)).success?(await (0,R.v5)(e),v.Am.success("".concat(E.size," leads exclu\xeddos com sucesso")),D(new Set),ek()):v.Am.error("Erro ao excluir leads")}catch(e){console.error("Erro ao excluir leads:",e),v.Am.error("Erro ao excluir leads")}I(!1)}},eM=async(a,s)=>{let t=e.filter(e=>E.has(e.id)),r="leads_export_".concat(new Date().toISOString().split("T")[0]);try{"csv"===a?await en(t,r,s):await ei(t,r,s),await (0,R.hn)(t.length,a),v.Am.success("Exporta\xe7\xe3o ".concat(a.toUpperCase()," conclu\xedda!"))}catch(e){console.error("Erro na exporta\xe7\xe3o:",e),v.Am.error("Erro ao exportar leads")}},eR=e=>({Novo:"bg-blue-500","Contato Inicial":"bg-purple-500","Proposta Enviada":"bg-orange-500",Negociação:"bg-indigo-500",Fechado:"bg-green-500","Follow-up":"bg-pink-500"})[e]||"bg-gray-500";return s?(0,t.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)(c.Z,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Carregando leads..."})]})}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-4xl font-bold mb-2 flex items-center gap-3",children:[(0,t.jsx)(m.Z,{className:"h-10 w-10 text-primary"}),"Leads"]}),(0,t.jsxs)("p",{className:"text-xl text-muted-foreground",children:[eE.length," leads encontrados"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center border rounded-lg",children:[(0,t.jsx)(n.z,{variant:"list"===w?"secondary":"ghost",size:"sm",onClick:()=>_("list"),className:"rounded-r-none",children:(0,t.jsx)(u.Z,{className:"h-4 w-4"})}),(0,t.jsx)(n.z,{variant:"kanban"===w?"secondary":"ghost",size:"sm",onClick:()=>_("kanban"),className:"rounded-l-none",children:(0,t.jsx)(p.Z,{className:"h-4 w-4"})})]}),(0,t.jsxs)(n.z,{variant:"outline",onClick:eS,disabled:b,className:"gap-2",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 ".concat(b?"animate-spin":"")}),b?"Atualizando...":"Atualizar"]})]})]}),"kanban"===w?(0,t.jsx)(ec.m,{leads:eE,onLeadUpdate:ek}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C,{statusFilter:H,setStatusFilter:K,hasWhatsAppFilter:Y,setHasWhatsAppFilter:Q,whatsappStatusFilter:ee,setWhatsappStatusFilter:es,cidadeFilter:et,setCidadeFilter:er,bairroFilter:el,setBairroFilter:eu}),E.size>0&&(0,t.jsx)(z,{selectedCount:E.size,onExport:()=>O(!0),onWhatsApp:()=>W(!0),onApplyTemplate:()=>P(!0),onDelete:()=>I(!0),onClearSelection:()=>D(new Set),canExport:k.canExport,canSendWhatsApp:k.canSendWhatsApp,canUpdate:k.canUpdate,canDelete:k.canDelete}),(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden bg-card",children:(0,t.jsx)("div",{className:"leads-table-container",children:(0,t.jsxs)(o.iA,{children:[(0,t.jsx)(o.xD,{className:"sticky top-0 bg-card z-10",children:(0,t.jsxs)(o.SC,{children:[(0,t.jsx)(o.ss,{className:"w-12",children:(0,t.jsx)(i.X,{checked:E.size===ez.length&&ez.length>0,onCheckedChange:()=>{E.size===ez.length?D(new Set):D(new Set(ez.map(e=>e.id)))}})}),(0,t.jsxs)(o.ss,{className:"cursor-pointer",onClick:()=>eW("lead"),children:["Lead ",(0,t.jsx)(x.Z,{className:"inline h-4 w-4 ml-1"})]}),(0,t.jsxs)(o.ss,{className:"cursor-pointer",onClick:()=>eW("empresa"),children:["Empresa ",(0,t.jsx)(x.Z,{className:"inline h-4 w-4 ml-1"})]}),(0,t.jsx)(o.ss,{children:"Categoria"}),(0,t.jsx)(o.ss,{children:"WhatsApp"}),(0,t.jsx)(o.ss,{children:"Cidade"}),(0,t.jsxs)(o.ss,{className:"cursor-pointer",onClick:()=>eW("status"),children:["Status ",(0,t.jsx)(x.Z,{className:"inline h-4 w-4 ml-1"})]}),(0,t.jsx)(o.ss,{children:"A\xe7\xf5es"})]})}),(0,t.jsx)(o.RM,{children:ez.map(e=>(0,t.jsxs)(o.SC,{children:[(0,t.jsx)(o.pj,{children:(0,t.jsx)(i.X,{checked:E.has(e.id),onCheckedChange:()=>eT(e.id)})}),(0,t.jsx)(o.pj,{className:"font-medium",children:e.lead}),(0,t.jsx)(o.pj,{children:(0,A.LF)(e.empresa||"")}),(0,t.jsx)(o.pj,{children:(0,A.LF)(e.categoria||"")}),(0,t.jsx)(o.pj,{children:e.whatsapp?(0,t.jsxs)("a",{href:"https://wa.me/".concat(e.whatsapp.replace(/\D/g,"")),target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:underline flex items-center gap-1",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4"}),e.whatsapp]}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"-"})}),(0,t.jsx)(o.pj,{children:(0,A.LF)(e.cidade||"")}),(0,t.jsx)(o.pj,{children:(0,t.jsx)(d.C,{className:"".concat(eR(e.status||"Novo")," text-white"),children:e.status||"Novo"})}),(0,t.jsx)(o.pj,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ed.p,{requiredPermission:"canUpdate",children:(0,t.jsx)(n.z,{variant:"ghost",size:"icon",onClick:()=>eF(e),children:(0,t.jsx)(f.Z,{className:"h-4 w-4"})})}),e.website&&(0,t.jsx)(n.z,{variant:"ghost",size:"icon",asChild:!0,children:(0,t.jsx)("a",{href:e.website,target:"_blank",rel:"noopener noreferrer",children:(0,t.jsx)(j.Z,{className:"h-4 w-4"})})})]})})]},e.id))})]})})}),eD>1&&(0,t.jsx)(eh,{children:(0,t.jsxs)(ex,{children:[(0,t.jsx)(eg,{children:(0,t.jsx)(ej,{onClick:()=>e_(e=>Math.max(1,e-1)),className:1===eA?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,eD)},(e,a)=>{let s;return s=eD<=5?a+1:eA<=3?a+1:eA>=eD-2?eD-4+a:eA-2+a,(0,t.jsx)(eg,{children:(0,t.jsx)(ef,{onClick:()=>e_(s),isActive:eA===s,className:"cursor-pointer",children:s})},s)}),(0,t.jsx)(eg,{children:(0,t.jsx)(ev,{onClick:()=>e_(e=>Math.min(eD,e+1)),className:eA===eD?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]}),(0,t.jsx)(Z,{isOpen:T,onClose:()=>W(!1),selectedLeads:e.filter(e=>E.has(e.id))}),(0,t.jsx)(q,{isOpen:F,onClose:()=>O(!1),onExport:eM,availableColumns:["Lead","Status","Data","Empresa","Categoria","Contato","WhatsApp","Telefone","Email","Website","Instagram","Cidade","Endere\xe7o","Bairro/Regi\xe3o","Link Google Maps","CNPJ","Resumo Anal\xedtico"]}),(0,t.jsx)(ea,{isOpen:M,onClose:()=>P(!1),selectedLeads:e.filter(e=>E.has(e.id)),onTemplateApplied:()=>{ek(),P(!1),v.Am.success("Templates aplicados! Pronto para enviar.",{description:"Clique em 'Enviar WhatsApp' para disparar as mensagens.",action:{label:"Enviar Agora",onClick:()=>W(!0)},duration:8e3})}}),(0,t.jsx)(V.t,{open:U,onClose:()=>{B(!1),$(null)},lead:G,onSuccess:()=>{ek(),B(!1),$(null)}}),(0,t.jsx)(em.aR,{open:L,onOpenChange:I,children:(0,t.jsxs)(em._T,{children:[(0,t.jsxs)(em.fY,{children:[(0,t.jsx)(em.f$,{children:"Confirmar exclus\xe3o"}),(0,t.jsxs)(em.yT,{children:["Tem certeza que deseja excluir ",E.size," lead(s)? Esta a\xe7\xe3o n\xe3o pode ser desfeita."]})]}),(0,t.jsxs)(em.xo,{children:[(0,t.jsx)(em.le,{children:"Cancelar"}),(0,t.jsx)(em.OL,{onClick:eO,className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})})]})}ev.displayName="PaginationNext"},9674:function(e,a,s){"use strict";s.d(a,{p:function(){return l}});var t=s(57437),r=s(91696);function l(e){let{children:a,allowedRoles:s,requiredPermission:l,fallback:n=null,inverse:i=!1}=e,{role:o,hasPermission:d,isLoading:c}=(0,r.j)();if(c)return null;let m=!1;return s&&s.length>0&&(m=s.includes(o)),l&&(m=d(l)),s||l||(m=!0),i&&(m=!m),m?(0,t.jsx)(t.Fragment,{children:a}):(0,t.jsx)(t.Fragment,{children:n})}},30767:function(e,a,s){"use strict";s.d(a,{OL:function(){return f},_T:function(){return u},aR:function(){return o},f$:function(){return x},fY:function(){return p},le:function(){return j},vW:function(){return d},xo:function(){return h},yT:function(){return g}});var t=s(57437),r=s(2265),l=s(7880),n=s(93448),i=s(12381);let o=l.fC,d=l.xz,c=l.h_,m=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:a})});m.displayName=l.aV.displayName;let u=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsxs)(c,{children:[(0,t.jsx)(m,{}),(0,t.jsx)(l.VY,{ref:a,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});u.displayName=l.VY.displayName;let p=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...s})};p.displayName="AlertDialogHeader";let h=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};h.displayName="AlertDialogFooter";let x=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.Dx,{ref:a,className:(0,n.cn)("text-lg font-semibold",s),...r})});x.displayName=l.Dx.displayName;let g=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.dk,{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});g.displayName=l.dk.displayName;let f=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.aU,{ref:a,className:(0,n.cn)((0,i.d)(),s),...r})});f.displayName=l.aU.displayName;let j=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.$j,{ref:a,className:(0,n.cn)((0,i.d)({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});j.displayName=l.$j.displayName},68245:function(e,a,s){"use strict";s.d(a,{X:function(){return o}});var t=s(57437),r=s(2265),l=s(9270),n=s(30401),i=s(93448);let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.fC,{ref:a,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...r,children:(0,t.jsx)(l.z$,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})})});o.displayName=l.fC.displayName},33804:function(e,a,s){"use strict";s.d(a,{RM:function(){return o},SC:function(){return d},iA:function(){return n},pj:function(){return m},ss:function(){return c},xD:function(){return i}});var t=s(57437),r=s(2265),l=s(93448);let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:(0,l.cn)("w-full caption-bottom text-sm",s),...r})})});n.displayName="Table";let i=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("thead",{ref:a,className:(0,l.cn)("[&_tr]:border-b",s),...r})});i.displayName="TableHeader";let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tbody",{ref:a,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...r})});o.displayName="TableBody",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tfoot",{ref:a,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tr",{ref:a,className:(0,l.cn)("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",s),...r})});d.displayName="TableRow";let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("th",{ref:a,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});c.displayName="TableHead";let m=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("td",{ref:a,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});m.displayName="TableCell",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("caption",{ref:a,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption"},33341:function(e,a,s){"use strict";s.d(a,{FA:function(){return l},hn:function(){return n},pA:function(){return i},v5:function(){return o}});var t=s(1072);let r=async e=>{try{console.log("[AUDIT]",{timestamp:new Date().toISOString(),...e});let{data:{user:a}}=await t.O.auth.getUser();if(!a){console.warn("[AUDIT] Usu\xe1rio n\xe3o autenticado, log n\xe3o salvo");return}let{error:s}=await t.O.from("audit_logs").insert({user_id:a.id,action:e.action,entity_type:e.entity_type,entity_id:e.entity_id,details:e.details,ip_address:null,user_agent:navigator.userAgent});if(s){console.error("[AUDIT] Erro ao salvar log:",s);let t=JSON.parse(localStorage.getItem("audit_logs_fallback")||"[]");t.push({timestamp:new Date().toISOString(),user_id:a.id,...e}),t.length>100&&t.shift(),localStorage.setItem("audit_logs_fallback",JSON.stringify(t))}}catch(e){console.error("[AUDIT] Erro ao registrar log de auditoria:",e)}},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let{data:a,error:s}=await t.O.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(e){return console.error("[AUDIT] Erro ao buscar logs:",e),[]}},n=(e,a)=>{r({action:"EXPORT_LEADS",entity_type:"lead",details:{leadCount:e,format:a}})},i=(e,a,s)=>{r({action:"WHATSAPP_DISPATCH",entity_type:"lead",details:{leadIds:e,successCount:a,failedCount:s,total:e.length}})},o=e=>{r({action:"BULK_DELETE_LEADS",entity_type:"lead",details:{leadIds:e,count:e.length}})}},76284:function(e,a,s){"use strict";s.d(a,{T:function(){return r}});var t=s(1072);let r={async getUserSettings(){try{let{data:{user:e}}=await t.O.auth.getUser();if(!e)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:a,error:s}=await t.O.from("user_settings").select("*").eq("user_id",e.id).single();if(s){if("PGRST116"===s.code)return{company_name:"",evolution_api_url:"",evolution_api_key:"",evolution_instance_name:""};throw s}return a}catch(e){return console.error("Erro ao buscar configura\xe7\xf5es:",e),{company_name:"",evolution_api_url:"",evolution_api_key:"",evolution_instance_name:""}}},async saveUserSettings(e){try{let{data:{user:a}}=await t.O.auth.getUser();if(!a)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:s}=await t.O.from("user_settings").select("id").eq("user_id",a.id).single();if(s){let{data:s,error:r}=await t.O.from("user_settings").update({company_name:e.company_name,evolution_api_url:e.evolution_api_url,evolution_api_key:e.evolution_api_key,evolution_instance_name:e.evolution_instance_name,updated_at:new Date().toISOString()}).eq("user_id",a.id).select().single();if(r)throw r;return s}{let{data:s,error:r}=await t.O.from("user_settings").insert({user_id:a.id,company_name:e.company_name,evolution_api_url:e.evolution_api_url,evolution_api_key:e.evolution_api_key,evolution_instance_name:e.evolution_instance_name}).select().single();if(r)throw r;return s}}catch(e){throw console.error("Erro ao salvar configura\xe7\xf5es:",e),e}}}},40359:function(e,a,s){"use strict";s.d(a,{K:function(){return r},g:function(){return t}});let t={formal:{label:"Formal",emoji:"\uD83D\uDC54",description:"Tom profissional e cordial"},casual:{label:"Casual",emoji:"\uD83D\uDE0A",description:"Tom descontra\xeddo e amig\xe1vel"},direto:{label:"Direto",emoji:"\uD83C\uDFAF",description:"Objetivo e sem rodeios"},consultivo:{label:"Consultivo",emoji:"\uD83D\uDCA1",description:"Tom educativo e orientador"},amigavel:{label:"Amig\xe1vel",emoji:"\uD83E\uDD1D",description:"Pr\xf3ximo e acolhedor"},executivo:{label:"Executivo",emoji:"\uD83D\uDCBC",description:"Conciso e corporativo"}},r=[{key:"{{minha_empresa}}",description:"Sua empresa (quem envia)"},{key:"{{empresa}}",description:"Nome da empresa prospectada"},{key:"{{categoria}}",description:"Categoria/nicho do neg\xf3cio"},{key:"{{cidade}}",description:"Cidade do lead"},{key:"{{contato}}",description:"Nome do contato"},{key:"{{lead}}",description:"ID do lead (Lead-001, etc.)"}]}},function(e){e.O(0,[425,457,918,318,250,923,400,763,713,706,115,72,14,916,645,871,741,919,971,117,744],function(){return e(e.s=19602)}),_N_E=e.O()}]);