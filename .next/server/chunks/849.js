"use strict";exports.id=849,exports.ids=[849],exports.modules={11890:(e,a,t)=>{t.d(a,{Z:()=>s});let s=(0,t(62881).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},39183:(e,a,t)=>{t.d(a,{Z:()=>s});let s=(0,t(62881).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},66099:(e,a,t)=>{t.d(a,{gZ:()=>m});var s=t(79258);let o={NOVO:"Novo",NOVO_LEAD:"Novo Lead",CONTATO_INICIAL:"Contato Inicial",QUALIFICACAO:"Qualifica\xe7\xe3o",PROPOSTA_ENVIADA:"Proposta Enviada",NEGOCIACAO:"Negocia\xe7\xe3o",FECHADO_GANHO:"Fechado Ganho",FECHADO_PERDIDO:"Fechado Perdido",EM_FOLLOWUP:"Em Follow-up"},r={NOT_SENT:"not_sent",SENT:"sent"},i={MEDIA:"M\xe9dia"},c={PROSPECCAO_ATIVA:"Prospec\xe7\xe3o Ativa",GOOGLE_PLACES:"Google Places"};function n(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").trim()}async function d(e,a,t){try{let o=n(e);if(a&&a.trim()){let e=a.replace(/\D/g,""),{data:t}=await s.O.from("leads_prospeccao").select("*").or(`whatsapp.ilike.%${e}%,telefone.ilike.%${e}%`).limit(1);if(t&&t.length>0)return{isDuplicate:!0,existingLead:l(t[0]),message:"Lead com este telefone/WhatsApp j\xe1 existe"}}if(t&&t.trim()){let e=t.replace(/^https?:\/\//,"").replace(/\/$/,"").toLowerCase(),{data:a}=await s.O.from("leads_prospeccao").select("*").ilike("website",`%${e}%`).limit(1);if(a&&a.length>0)return{isDuplicate:!0,existingLead:l(a[0]),message:"Lead com este website j\xe1 existe"}}let{data:r}=await s.O.from("leads_prospeccao").select("*").or(`lead.ilike.%${o}%,empresa.ilike.%${o}%`).limit(5);if(r&&r.length>0)for(let e of r){let a=n(e.lead||""),t=n(e.empresa||"");if(a===o||t===o)return{isDuplicate:!0,existingLead:l(e),message:"Lead com nome similar j\xe1 existe"}}return{isDuplicate:!1,message:"Lead \xfanico"}}catch(e){return console.error("Erro ao verificar duplicata:",e),{isDuplicate:!1,message:"Erro na verifica\xe7\xe3o"}}}function l(e){return{id:e.id,lead:e.lead||"",status:e.status||o.NOVO,data:e.data||"",empresa:e.empresa||"",categoria:e.categoria||"",contato:e.contato||"",whatsapp:e.whatsapp||"",telefone:e.telefone||"",email:e.email||"",website:e.website||"",instagram:e.instagram||"",cidade:e.cidade||"",endereco:e.endereco||"",bairro:e.bairro||"",bairroRegiao:e.bairro_regiao||"",linkGMN:e.link_gmn||"",aceitaCartao:e.aceita_cartao||"",cnpj:e.cnpj||"",mensagemWhatsApp:e.mensagem_whatsapp||"",statusMsgWA:e.status_msg_wa||r.NOT_SENT,dataEnvioWA:e.data_envio_wa||null,resumoAnalitico:e.resumo_analitico||"",createdAt:e.created_at||new Date().toISOString(),updatedAt:e.updated_at||new Date().toISOString(),origem:c.PROSPECCAO_ATIVA,prioridade:i.MEDIA,regiao:e.cidade||"",segmento:e.categoria||"",ticketMedioEstimado:0,contatoPrincipal:e.contato||"",dataContato:e.created_at||new Date().toISOString(),observacoes:""}}let m={syncAllLeads:async function(){try{let{data:e,error:a}=await s.O.from("leads_prospeccao").select("*").order("created_at",{ascending:!1});if(a)throw a;let t=(e||[]).map(e=>({id:e.id,lead:e.lead||"",status:e.status||o.NOVO,data:e.data||"",empresa:e.empresa||"",categoria:e.categoria||"",contato:e.contato||"",whatsapp:e.whatsapp||"",telefone:e.telefone||"",email:e.email||"",website:e.website||"",instagram:e.instagram||"",cidade:e.cidade||"",endereco:e.endereco||"",bairro:e.bairro||"",bairroRegiao:e.bairro_regiao||"",linkGMN:e.link_gmn||"",aceitaCartao:e.aceita_cartao||"",cnpj:e.cnpj||"",mensagemWhatsApp:e.mensagem_whatsapp||"",statusMsgWA:e.status_msg_wa||r.NOT_SENT,dataEnvioWA:e.data_envio_wa||null,resumoAnalitico:e.resumo_analitico||"",createdAt:e.created_at||new Date().toISOString(),updatedAt:e.updated_at||new Date().toISOString(),origem:c.PROSPECCAO_ATIVA,prioridade:i.MEDIA,regiao:e.cidade||"",segmento:e.categoria||"",ticketMedioEstimado:0,contatoPrincipal:e.contato||"",dataContato:e.created_at||new Date().toISOString(),observacoes:""}));return{success:!0,leads:t}}catch(e){return console.error("Erro ao sincronizar leads:",e),{success:!1,leads:[],message:e.message||"Erro ao carregar leads do banco de dados"}}},updateLead:async function(e,a){try{let t={};void 0!==a.lead&&(t.lead=a.lead),void 0!==a.status&&(t.status=a.status),void 0!==a.empresa&&(t.empresa=a.empresa),void 0!==a.categoria&&(t.categoria=a.categoria),void 0!==a.contato&&(t.contato=a.contato),void 0!==a.whatsapp&&(t.whatsapp=a.whatsapp),void 0!==a.telefone&&(t.telefone=a.telefone),void 0!==a.email&&(t.email=a.email),void 0!==a.cidade&&(t.cidade=a.cidade),void 0!==a.endereco&&(t.endereco=a.endereco),void 0!==a.bairro&&(t.bairro=a.bairro),void 0!==a.bairroRegiao&&(t.bairro_regiao=a.bairroRegiao),void 0!==a.website&&(t.website=a.website),void 0!==a.instagram&&(t.instagram=a.instagram),void 0!==a.linkGMN&&(t.link_gmn=a.linkGMN),void 0!==a.aceitaCartao&&(t.aceita_cartao=a.aceitaCartao),void 0!==a.mensagemWhatsApp&&(t.mensagem_whatsapp=a.mensagemWhatsApp),void 0!==a.statusMsgWA&&(t.status_msg_wa=a.statusMsgWA),void 0!==a.dataEnvioWA&&(t.data_envio_wa=a.dataEnvioWA),void 0!==a.resumoAnalitico&&(t.resumo_analitico=a.resumoAnalitico),void 0!==a.cnpj&&(t.cnpj=a.cnpj),void 0!==a.data&&(t.data=a.data),t.updated_at=new Date().toISOString();let{error:o}=await s.O.from("leads_prospeccao").update(t).eq("id",e);if(o)throw o;return{success:!0,message:"Lead atualizado com sucesso"}}catch(e){return console.error("Erro ao atualizar lead:",e),{success:!1,message:e.message||"Erro ao atualizar lead"}}},updateLeadStatus:async function(e,a){try{let{error:t}=await s.O.from("leads_prospeccao").update({status:a,estagio_pipeline:a,updated_at:new Date().toISOString()}).eq("id",e);if(t)throw t;return{success:!0,message:`Status atualizado para ${a}`}}catch(e){return console.error("Erro ao atualizar status:",e),{success:!1,message:e.message||"Erro ao atualizar status"}}},createLead:async function(e){try{let a=await d(e.lead||e.empresa||"",e.whatsapp,e.website);if(a.isDuplicate)return{success:!1,message:a.message};let t=e.status||o.NOVO_LEAD,{data:i,error:c}=await s.O.from("leads_prospeccao").insert({id:crypto.randomUUID(),lead:e.lead||"Lead-000",status:t,estagio_pipeline:t,empresa:e.empresa||"",categoria:e.categoria,contato:e.contatoPrincipal,whatsapp:e.whatsapp,telefone:e.telefone,email:e.email,cidade:e.cidade,endereco:e.endereco,bairro:e.bairro,bairro_regiao:e.bairroRegiao,website:e.website,instagram:e.instagram,link_gmn:e.linkGMN,aceita_cartao:e.aceitaCartao,mensagem_whatsapp:e.mensagemWhatsApp||"",status_msg_wa:e.statusMsgWA||r.NOT_SENT,resumo_analitico:e.resumoAnalitico,cnpj:e.cnpj,data:e.data||new Date().toISOString()}).select().single();if(c)throw c;return{success:!0,leadId:i.id,message:"Lead criado com sucesso"}}catch(e){return console.error("Erro ao criar lead:",e),{success:!1,message:e.message||"Erro ao criar lead"}}},getMetrics:async function(){try{let{data:e,error:a}=await s.O.from("leads_prospeccao").select("*");if(a)throw a;let t=e?.length||0,i={[o.NOVO_LEAD]:0,[o.CONTATO_INICIAL]:0,[o.QUALIFICACAO]:0,[o.PROPOSTA_ENVIADA]:0,[o.NEGOCIACAO]:0,[o.FECHADO_GANHO]:0,[o.FECHADO_PERDIDO]:0,[o.EM_FOLLOWUP]:0,Fechado:0,"Follow-up":0},n={},d=0,l=0;e?.forEach(e=>{let a=e.status||o.NOVO_LEAD;a in i&&i[a]++;let t=e.categoria||c.GOOGLE_PLACES;n[t]=(n[t]||0)+1,d+=0,e.status_msg_wa===r.SENT&&l++});let m=t>0?i[o.FECHADO_GANHO]/t*100:0,p={totalLeads:t,novoLeads:i[o.NOVO_LEAD],emNegociacao:i[o.NEGOCIACAO],fechadoGanho:i[o.FECHADO_GANHO],fechadoPerdido:i[o.FECHADO_PERDIDO],taxaConversao:m,ticketMedioTotal:d,leadsPorStatus:i,leadsPorOrigem:n,leadsPorRegiao:{},leadsPorSegmento:{},mensagensEnviadas:l,mensagensPendentes:t-l,proximosFollowUps:[]};return{success:!0,metrics:p}}catch(e){return console.error("Erro ao calcular m\xe9tricas:",e),{success:!1,message:e.message||"Erro ao calcular m\xe9tricas"}}},getLeadsForWhatsApp:async function(e){try{let{data:a,error:t}=await s.O.from("leads_prospeccao").select("*").in("id",e);if(t)throw t;let n=(a||[]).map(e=>({id:e.id,lead:e.lead||"",status:e.status||o.NOVO_LEAD,empresa:e.empresa||"",categoria:e.categoria||"",contato:e.contato||"",whatsapp:e.whatsapp||"",telefone:e.telefone||"",email:e.email||"",cidade:e.cidade||"",endereco:e.endereco||"",bairro:e.bairro||"",bairroRegiao:e.bairro_regiao||"",website:e.website||"",instagram:e.instagram||"",linkGMN:e.link_gmn||"",aceitaCartao:e.aceita_cartao||"",mensagemWhatsApp:e.mensagem_whatsapp||"",statusMsgWA:e.status_msg_wa||r.NOT_SENT,dataEnvioWA:e.data_envio_wa||null,resumoAnalitico:e.resumo_analitico||"",cnpj:e.cnpj||"",data:e.data||"",origem:c.GOOGLE_PLACES,prioridade:i.MEDIA,regiao:e.cidade||"",segmento:e.categoria||"",ticketMedioEstimado:0,contatoPrincipal:e.contato||"",dataContato:e.created_at||new Date().toISOString(),observacoes:""}));return{success:!0,leads:n}}catch(e){return console.error("Erro ao buscar leads para WhatsApp:",e),{success:!1,leads:[],message:e.message||"Erro ao buscar leads"}}},deleteLeads:async function(e){try{if(!e||0===e.length)return{success:!1,message:"Nenhum lead selecionado"};let{error:a}=await s.O.from("leads_prospeccao").delete().in("id",e);if(a)throw a;return{success:!0,message:`${e.length} leads exclu\xeddos com sucesso`}}catch(e){return console.error("Erro ao excluir leads:",e),{success:!1,message:e.message||"Erro ao excluir leads"}}},checkDuplicateLead:d,mergeLeads:async function(e,a){try{let{data:t,error:o}=await s.O.from("leads_prospeccao").select("*").in("id",[e,a]);if(o||!t||2!==t.length)return{success:!1,message:"N\xe3o foi poss\xedvel encontrar os leads para mesclar"};let r=t.find(a=>a.id===e),i=t.find(e=>e.id===a);if(!r||!i)return{success:!1,message:"Leads n\xe3o encontrados"};let c={lead:r.lead||i.lead,empresa:r.empresa||i.empresa,categoria:r.categoria||i.categoria,contato:r.contato||i.contato,whatsapp:r.whatsapp||i.whatsapp,telefone:r.telefone||i.telefone,email:r.email||i.email,website:r.website||i.website,instagram:r.instagram||i.instagram,cidade:r.cidade||i.cidade,endereco:r.endereco||i.endereco,bairro:r.bairro||i.bairro,link_gmn:r.link_gmn||i.link_gmn,resumo_analitico:r.resumo_analitico||i.resumo_analitico,updated_at:new Date().toISOString()},{error:n}=await s.O.from("leads_prospeccao").update(c).eq("id",e);if(n)throw n;let{error:d}=await s.O.from("leads_prospeccao").delete().eq("id",a);if(d)throw d;return{success:!0,message:"Leads mesclados com sucesso"}}catch(e){return console.error("Erro ao mesclar leads:",e),{success:!1,message:e.message}}},clearLeadHistory:async function(e){try{let{error:a}=await s.O.from("leads_prospeccao").update({mensagem_whatsapp:null,status_msg_wa:r.NOT_SENT,data_envio_wa:null,resumo_analitico:null,updated_at:new Date().toISOString()}).eq("id",e);if(a)throw a;return{success:!0,message:"Hist\xf3rico do lead limpo com sucesso"}}catch(e){return console.error("Erro ao limpar hist\xf3rico:",e),{success:!1,message:e.message}}}}}};