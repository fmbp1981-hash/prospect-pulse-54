(()=>{var e={};e.id=892,e.ids=[892],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},83305:(e,a,s)=>{"use strict";s.r(a),s.d(a,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(65634),s(34896),s(84752),s(96560);var t=s(23191),r=s(88716),l=s(37922),i=s.n(l),o=s(95231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(a,n);let d=["",{children:["(protected)",{children:["integrations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,65634)),"C:\\Projects\\prospect-pulse-54\\app\\(protected)\\integrations\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,34896)),"C:\\Projects\\prospect-pulse-54\\app\\(protected)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,84752)),"C:\\Projects\\prospect-pulse-54\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"C:\\Projects\\prospect-pulse-54\\app\\not-found.tsx"]}],c=["C:\\Projects\\prospect-pulse-54\\app\\(protected)\\integrations\\page.tsx"],m="/(protected)/integrations/page",p={require:s,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(protected)/integrations/page",pathname:"/integrations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},27480:(e,a,s)=>{Promise.resolve().then(s.bind(s,40053))},40053:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>E});var t=s(10326),r=s(17577),l=s(29752),i=s(44794),o=s(41190),n=s(91664),d=s(38443),c=s(50384),m=s(41156),p=s(66307),x=s(69669),u=s(62881);let h=(0,u.Z)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var g=s(21405);let j=(0,u.Z)("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var f=s(1388);let v=(0,u.Z)("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);var b=s(43810),y=s(31215),N=s(85999),w=s(41353),_=s(22966),k=s(79360),A=s(51223);let P=(0,k.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),S=r.forwardRef(({className:e,variant:a,...s},r)=>t.jsx("div",{ref:r,role:"alert",className:(0,A.cn)(P({variant:a}),e),...s}));S.displayName="Alert";let C=r.forwardRef(({className:e,...a},s)=>t.jsx("h5",{ref:s,className:(0,A.cn)("mb-1 font-medium leading-none tracking-tight",e),...a}));C.displayName="AlertTitle";let T=r.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:(0,A.cn)("text-sm [&_p]:leading-relaxed",e),...a}));function E(){let{isAdmin:e,isLoading:a}=(0,_.j)(),[s,u]=(0,r.useState)(""),[k,A]=(0,r.useState)([]),[P,E]=(0,r.useState)(!1),[R,Z]=(0,r.useState)(!1),I=async()=>{E(!0);try{let e=await (0,w.FA)(50);A(e)}catch(e){console.error("Erro ao carregar logs:",e)}finally{E(!1)}},D=e=>{let a={EXPORT_LEADS:{color:"bg-blue-500",icon:p.Z},WHATSAPP_DISPATCH:{color:"bg-green-500",icon:p.Z},START_PROSPECTION:{color:"bg-purple-500",icon:p.Z},BULK_DELETE_LEADS:{color:"bg-red-500",icon:x.Z}}[e]||{color:"bg-gray-500",icon:h},s=a.icon;return(0,t.jsxs)(d.C,{className:`${a.color} text-white gap-1`,children:[t.jsx(s,{className:"h-3 w-3"}),e.replace(/_/g," ")]})},z=e=>{let a=new Date(e);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)};return a?t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:t.jsx(g.Z,{className:"h-8 w-8 animate-spin text-primary"})})}):e?(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[(0,t.jsxs)("div",{className:"animate-fade-in",children:[(0,t.jsxs)("h1",{className:"text-4xl font-bold mb-2 flex items-center gap-3",children:[t.jsx(f.Z,{className:"h-10 w-10 text-primary"}),"Integra\xe7\xf5es"]}),t.jsx("p",{className:"text-xl text-muted-foreground",children:"Configure webhooks e visualize logs de integra\xe7\xe3o"})]}),(0,t.jsxs)(c.mQ,{defaultValue:"webhooks",className:"animate-fade-in",children:[(0,t.jsxs)(c.dr,{className:"grid w-full grid-cols-2 max-w-md",children:[(0,t.jsxs)(c.SP,{value:"webhooks",className:"gap-2",children:[t.jsx(v,{className:"h-4 w-4"}),"Webhooks"]}),(0,t.jsxs)(c.SP,{value:"logs",className:"gap-2",children:[t.jsx(h,{className:"h-4 w-4"}),"Logs de Auditoria"]})]}),(0,t.jsxs)(c.nU,{value:"webhooks",className:"space-y-6",children:[t.jsx(l.Zb,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-2xl font-semibold",children:"Webhook WhatsApp (n8n)"}),t.jsx(d.C,{variant:"outline",children:"Evolution API"})]}),t.jsx("p",{className:"text-muted-foreground",children:"Configure o endpoint do n8n que recebe os disparos de WhatsApp. Este webhook deve processar os leads e enviar as mensagens via Evolution API."}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(i._,{htmlFor:"webhook-url",children:"URL do Webhook"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx(o.I,{id:"webhook-url",placeholder:"https://n8n.seudominio.com/webhook/whatsapp",value:s,onChange:e=>u(e.target.value),className:"flex-1"}),t.jsx(n.z,{variant:"outline",size:"icon",onClick:()=>{navigator.clipboard.writeText(s),N.Am.success("URL copiada para \xe1rea de transfer\xeancia")},disabled:!s,children:t.jsx(b.Z,{className:"h-4 w-4"})})]})]}),t.jsx("div",{className:"flex gap-2",children:(0,t.jsxs)(n.z,{onClick:()=>{try{localStorage.setItem("whatsapp_webhook_url",s),N.Am.success("Webhook salvo com sucesso!")}catch(e){N.Am.error("Erro ao salvar webhook")}},children:[t.jsx(y.Z,{className:"h-4 w-4 mr-2"}),"Salvar Configura\xe7\xe3o"]})}),(0,t.jsxs)("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"ℹ️ Informa\xe7\xf5es Importantes"}),(0,t.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[t.jsx("li",{children:"O webhook deve aceitar POST requests com JSON payload"}),t.jsx("li",{children:"Payload cont\xe9m: leadId, whatsapp, message, leadName, empresa"}),(0,t.jsxs)("li",{children:["Resposta esperada: ","{ success: true }"," ou ",'{ success: false, error: "..." }']}),t.jsx("li",{children:"Configura\xe7\xe3o armazenada localmente (localStorage)"})]})]})]})}),t.jsx(l.Zb,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-2xl font-semibold",children:"Supabase"}),(0,t.jsxs)(d.C,{className:"bg-green-500 text-white gap-1",children:[t.jsx(p.Z,{className:"h-3 w-3"}),"Conectado"]})]}),t.jsx("p",{className:"text-muted-foreground",children:"Banco de dados e autentica\xe7\xe3o gerenciados pelo Supabase. Configura\xe7\xe3o via vari\xe1veis de ambiente (somente leitura)."}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(i._,{children:"Project URL"}),t.jsx(o.I,{value:"https://kzvnwqlcrtxwagxkghxq.supabase.co",disabled:!0,className:"bg-muted"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(i._,{children:"Status"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(p.Z,{className:"h-5 w-5 text-green-500"}),t.jsx("span",{className:"text-sm",children:"Conectado e operacional"})]})]})]})})]}),t.jsx(c.nU,{value:"logs",className:"space-y-4",children:(0,t.jsxs)(l.Zb,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold",children:"Logs de Auditoria"}),t.jsx("p",{className:"text-muted-foreground",children:"Hist\xf3rico de todas as a\xe7\xf5es cr\xedticas realizadas"})]}),(0,t.jsxs)(n.z,{variant:"outline",size:"sm",onClick:I,disabled:P,children:[t.jsx(g.Z,{className:`h-4 w-4 mr-2 ${P?"animate-spin":""}`}),"Atualizar"]})]}),P?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(g.Z,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),"Carregando logs..."]}):0===k.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(h,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"Nenhum log de auditoria encontrado"}),t.jsx("p",{className:"text-sm mt-1",children:"Os logs aparecer\xe3o aqui ap\xf3s a\xe7\xf5es no sistema"})]}):t.jsx("div",{className:"border rounded-lg overflow-hidden",children:(0,t.jsxs)(m.iA,{children:[t.jsx(m.xD,{children:(0,t.jsxs)(m.SC,{children:[t.jsx(m.ss,{children:"Data/Hora"}),t.jsx(m.ss,{children:"A\xe7\xe3o"}),t.jsx(m.ss,{children:"Tipo"}),t.jsx(m.ss,{children:"Detalhes"})]})}),t.jsx(m.RM,{children:k.map(e=>(0,t.jsxs)(m.SC,{children:[t.jsx(m.pj,{className:"text-sm whitespace-nowrap",children:z(e.created_at)}),t.jsx(m.pj,{children:D(e.action)}),t.jsx(m.pj,{children:t.jsx(d.C,{variant:"outline",children:e.entity_type})}),t.jsx(m.pj,{className:"text-sm text-muted-foreground max-w-md truncate",children:e.details&&Object.keys(e.details).length>0?JSON.stringify(e.details).substring(0,100)+"...":"—"})]},e.id))})]})})]})})]})]}):t.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)(S,{variant:"destructive",children:[t.jsx(j,{className:"h-5 w-5"}),t.jsx(C,{children:"Acesso Negado"}),t.jsx(T,{children:"Apenas administradores podem acessar a p\xe1gina de Integra\xe7\xf5es. Entre em contato com um administrador se precisar configurar webhooks ou visualizar logs de auditoria."})]})})}T.displayName="AlertDescription"},66307:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(62881).Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},69669:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(62881).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},31215:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(62881).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},41156:(e,a,s)=>{"use strict";s.d(a,{RM:()=>n,SC:()=>d,iA:()=>i,pj:()=>m,ss:()=>c,xD:()=>o});var t=s(10326),r=s(17577),l=s(51223);let i=r.forwardRef(({className:e,...a},s)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",e),...a})}));i.displayName="Table";let o=r.forwardRef(({className:e,...a},s)=>t.jsx("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",e),...a}));o.displayName="TableHeader";let n=r.forwardRef(({className:e,...a},s)=>t.jsx("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",e),...a}));n.displayName="TableBody",r.forwardRef(({className:e,...a},s)=>t.jsx("tfoot",{ref:s,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";let d=r.forwardRef(({className:e,...a},s)=>t.jsx("tr",{ref:s,className:(0,l.cn)("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...a}));d.displayName="TableRow";let c=r.forwardRef(({className:e,...a},s)=>t.jsx("th",{ref:s,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));c.displayName="TableHead";let m=r.forwardRef(({className:e,...a},s)=>t.jsx("td",{ref:s,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));m.displayName="TableCell",r.forwardRef(({className:e,...a},s)=>t.jsx("caption",{ref:s,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption"},41353:(e,a,s)=>{"use strict";s.d(a,{FA:()=>l,hn:()=>i,pA:()=>o,v5:()=>n});var t=s(79258);let r=async e=>{try{console.log("[AUDIT]",{timestamp:new Date().toISOString(),...e});let{data:{user:a}}=await t.O.auth.getUser();if(!a){console.warn("[AUDIT] Usu\xe1rio n\xe3o autenticado, log n\xe3o salvo");return}let{error:s}=await t.O.from("audit_logs").insert({user_id:a.id,action:e.action,entity_type:e.entity_type,entity_id:e.entity_id,details:e.details,ip_address:null,user_agent:navigator.userAgent});if(s){console.error("[AUDIT] Erro ao salvar log:",s);let t=JSON.parse(localStorage.getItem("audit_logs_fallback")||"[]");t.push({timestamp:new Date().toISOString(),user_id:a.id,...e}),t.length>100&&t.shift(),localStorage.setItem("audit_logs_fallback",JSON.stringify(t))}}catch(e){console.error("[AUDIT] Erro ao registrar log de auditoria:",e)}},l=async(e=100)=>{try{let{data:a,error:s}=await t.O.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(e){return console.error("[AUDIT] Erro ao buscar logs:",e),[]}},i=(e,a)=>{r({action:"EXPORT_LEADS",entity_type:"lead",details:{leadCount:e,format:a}})},o=(e,a,s)=>{r({action:"WHATSAPP_DISPATCH",entity_type:"lead",details:{leadIds:e,successCount:a,failedCount:s,total:e.length}})},n=e=>{r({action:"BULK_DELETE_LEADS",entity_type:"lead",details:{leadIds:e,count:e.length}})}},65634:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>t});let t=(0,s(68570).createProxy)(String.raw`C:\Projects\prospect-pulse-54\app\(protected)\integrations\page.tsx#default`)}};var a=require("../../../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),t=a.X(0,[164,424,267,365],()=>s(83305));module.exports=t})();